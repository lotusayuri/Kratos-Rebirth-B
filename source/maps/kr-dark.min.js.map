{"version":3,"sources":["kr-dark.js"],"names":["darkmodeCss","document","getElementById","darkModeStorageKey","getLS","k","localStorage","getItem","e","getModeFromCSSMediaQuery","window","matchMedia","matches","validColorModeKeys","dark","light","emitColorMode","mode","currentSetting","systemTheme","documentElement","setAttribute","removeItem","removeLS","removeAttribute","invertDarkModeObj","toggleColorMode","v","setItem","setLS","krDarkInit","removeEventListener","addEventListener","readyState","setTimeout"],"mappings":"AAAA,cAMA,WACI,IAAMA,EAAcC,SAASC,eAAe,gBACtCC,EAAqB,oBAyBrBC,EAAQ,SAACC,GACX,IACI,OAAOC,aAAaC,QAAQF,EAChC,CAAE,MAAOG,GAEL,OAAO,IACX,CACJ,EAKMC,EAA2B,WAC7B,OAAOC,OAAOC,WAAW,gCAAgCC,QACnD,OACA,OACV,EAKMC,EAAqB,CACvBC,MAAQ,EACRC,OAAS,GAMPC,EAAgB,SAACC,GACnB,IAAIC,EAAiBD,GAAQb,EAAMD,GAC7BgB,EAAcV,IAQpB,OANAR,SAASmB,gBAAgBC,aAAa,aAAcH,GAAkBC,GAEjEN,EAAmBK,IAAmBA,IAAmBC,KA7CjD,SAACd,GACd,IACIC,aAAagB,WAAWjB,EAC5B,CAAE,MAAOG,GACL,CAER,CAwCQe,CAASpB,GACTe,EAAiB,MAEbA,GACJ,IAAK,OACDlB,EAAYqB,aAAa,QAAS,OAClCrB,EAAYwB,gBAAgB,YAC5B,MACJ,IAAK,QACDxB,EAAYqB,aAAa,WAAY,YACrC,MACJ,QACIrB,EAAYqB,aAAa,QAAS,gCAClCrB,EAAYwB,gBAAgB,YAGxC,EAEMC,EAAoB,CACtBX,KAAQ,QACRC,MAAS,QAMPW,EAAkB,WACpB,IAAIR,EAAiBd,EAAMD,GAO3B,OALIe,EADAL,EAAmBK,GACFO,EAAkBP,GAElBO,EAAkBhB,KAvF7B,SAACJ,EAAGsB,GACd,IACIrB,aAAasB,QAAQvB,EAAGsB,EAC5B,CAAE,MAAOnB,GACL,CAER,CAmFIqB,CAAM1B,EAAoBe,GACnBA,CACX,EAGAF,IAEA,IAAMc,EAAa,SAAbA,IACF7B,SAAS8B,oBAAoB,mBAAoBD,GAAY,GAC7DpB,OAAOqB,oBAAoB,OAAQD,GAAY,GAEjB7B,SAASC,eAAe,mBAChC8B,iBAAiB,SAAS,WAC5ChB,EAAcU,IAClB,GACJ,EAE4B,aAAxBzB,SAASgC,WACTC,WAAWJ,IAEX7B,SAAS+B,iBAAiB,mBAAoBF,GAAY,GAC1DpB,OAAOsB,iBAAiB,OAAQF,GAAY,GAEnD,CAvHD","file":"../js/kr-dark.min.js","sourcesContent":["/*\r\n * Reference: \r\n * - [你好黑暗，我的老朋友 —— 为网站添加用户友好的深色模式支持 by Sukka]\r\n *   (https://blog.skk.moe/post/hello-darkmode-my-old-friend/)\r\n */\r\n// 作为直接影响渲染的脚本，应该在最开始就加载，不应该defer\r\n(() => {\r\n    const darkmodeCss = document.getElementById('darkmode-css')\r\n    const darkModeStorageKey = 'user-color-scheme';\r\n\r\n    /**\r\n     * 设置 LocalStorage 的指定属性\r\n     */\r\n    const setLS = (k, v) => {\r\n        try {\r\n            localStorage.setItem(k, v);\r\n        } catch (e) {\r\n            // (此处不进行处理)\r\n        }\r\n    };\r\n    /**\r\n     * 移除 LocalStorage 的指定属性\r\n     */\r\n    const removeLS = (k) => {\r\n        try {\r\n            localStorage.removeItem(k);\r\n        } catch (e) {\r\n            // (此处不进行处理)\r\n        }\r\n    };\r\n    /**\r\n     * 获取 LocalStorage 的指定属性\r\n     */\r\n    const getLS = (k) => {\r\n        try {\r\n            return localStorage.getItem(k);\r\n        } catch (e) {\r\n            // 与 localStorage 中没有找到对应 key 的行为一致\r\n            return null;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * 获取当前生效的显示模式（深色/浅色）名称\r\n     */\r\n    const getModeFromCSSMediaQuery = () => {\r\n        return window.matchMedia('(prefers-color-scheme: dark)').matches\r\n            ? 'dark'\r\n            : 'light'\r\n    };\r\n\r\n    /**\r\n     * 校验key\r\n     */\r\n    const validColorModeKeys = {\r\n        'dark': true,\r\n        'light': true\r\n    };\r\n\r\n    /**\r\n     * 提交指定的深色/浅色显示模式的设置\r\n     */\r\n    const emitColorMode = (mode) => {\r\n        let currentSetting = mode || getLS(darkModeStorageKey);\r\n        const systemTheme = getModeFromCSSMediaQuery();\r\n        // 在 html tag 上设置主题颜色，方便第三方插件读取使用\r\n        document.documentElement.setAttribute('data-theme', currentSetting || systemTheme);\r\n        // 检查是否无效或可以被忽略\r\n        if (!validColorModeKeys[currentSetting] || currentSetting === systemTheme) {\r\n            removeLS(darkModeStorageKey); //reset\r\n            currentSetting = null;\r\n        }\r\n        switch (currentSetting) {\r\n            case \"dark\":\r\n                darkmodeCss.setAttribute('media', 'all');\r\n                darkmodeCss.removeAttribute('disabled');\r\n                break;\r\n            case \"light\":\r\n                darkmodeCss.setAttribute('disabled', 'disabled');\r\n                break;\r\n            default:\r\n                darkmodeCss.setAttribute('media', '(prefers-color-scheme: dark)');\r\n                darkmodeCss.removeAttribute('disabled');\r\n                break;\r\n        }\r\n    };\r\n\r\n    const invertDarkModeObj = {\r\n        'dark': 'light',\r\n        'light': 'dark'\r\n    };\r\n\r\n    /**\r\n     * 切换显示模式（深色/浅色）\r\n     */\r\n    const toggleColorMode = () => {\r\n        let currentSetting = getLS(darkModeStorageKey);\r\n        if (validColorModeKeys[currentSetting]) {\r\n            currentSetting = invertDarkModeObj[currentSetting];\r\n        } else {\r\n            currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];\r\n        }\r\n        setLS(darkModeStorageKey, currentSetting);\r\n        return currentSetting;\r\n    };\r\n\r\n    // 加载页面时即立刻提交一次\r\n    emitColorMode();\r\n\r\n    const krDarkInit = () => {\r\n        document.removeEventListener(\"DOMContentLoaded\", krDarkInit, false);\r\n        window.removeEventListener(\"load\", krDarkInit, false);\r\n\r\n        const darkModeSwitchElement = document.getElementById('darkmode-switch');\r\n        darkModeSwitchElement.addEventListener('click', () => {\r\n            emitColorMode(toggleColorMode());\r\n        });\r\n    };\r\n\r\n    if (document.readyState === \"complete\") {\r\n        setTimeout(krDarkInit);\r\n    } else {\r\n        document.addEventListener(\"DOMContentLoaded\", krDarkInit, false);\r\n        window.addEventListener(\"load\", krDarkInit, false); //fallback\r\n    }\r\n})();\r\n"]}